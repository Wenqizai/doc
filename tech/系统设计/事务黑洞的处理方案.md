## Ask 

```
äº‹åŠ¡çš„çŠ¶æ€ï¼Œåœ¨ä¸€ä¸ªspringboot+mysqlçš„æ¶æ„ä¸­ï¼ŒæœåŠ¡è¯·æ±‚updateæ•°æ®åº“ï¼Œè·å–åˆ°updateæˆåŠŸçš„å“åº”ç„¶åæ‰§è¡Œåç»­ä¸šåŠ¡é€»è¾‘ã€‚é—®å½“æ•°æ®åº“é‡å¯ï¼Œæˆ–è€…ç½‘ç»œæŠ–åŠ¨ï¼ŒæœåŠ¡è¯·æ±‚çœ‹åˆ°è¯·æ±‚å¤±è´¥ã€‚æ•°æ®åº“å¯èƒ½æ‰§è¡Œä»»åŠ¡æˆåŠŸ/å¤±è´¥ï¼Œé‚£ä¹ˆæœåŠ¡è¯·æ±‚è¯¥å¦‚ä½•åˆ¤å®šè¿™ä¸ªè¯·æ±‚æ˜¯æˆåŠŸæˆ–å¤±è´¥ã€‚æœåŠ¡ä¼šä¸»åŠ¨å›æ»šä¹‹å‰çš„äº‹åŠ¡ä¹ˆï¼Ÿ
```

## ğŸ¤– Assistant

<div style="border: 2px solid #dddddd; border-radius: 10px;">
  <details style="padding: 5px;">
    <summary>å·²æ·±åº¦æ€è€ƒ</summary>
    **Clarifying the Scenario**<br><br>I'm currently focused on deconstructing the user's query, specifically the "happy path" where a Spring Boot service updates a MySQL database. I'm starting to visualize the typical transaction flow. The next step is outlining the various states a transaction can go through, considering the happy path.<br><br><br>**Refining the Approach**<br><br>I'm now fully immersed in the role of a Principal Backend Architect. The user's query about transaction ambiguity in Spring Boot with MySQL demands a comprehensive response. I'm focusing on the "why" and "how" behind the issue. I'm exploring various architectural patterns and trade-offs to ensure a robust and long-term solution. This necessitates a clear, structured explanation addressing the core challenges.<br><br><br>**Examining Transaction States**<br><br>I'm now diving into the precise states a transaction undergoes within the happy path. Considering network interruptions and MySQL's behavior is critical. Exploring the transaction's lifecycle from the initial request through potential commit, rollbacks, or uncertainty. This necessitates a thorough analysis of how Spring's `@Transactional` interacts with the underlying database to fully address the user's issue.<br><br><br>**Evaluating the Trade-offs**<br><br>I've been analyzing the pros and cons of different solutions, starting with the simple retry and highlighting why it fails. Now, I am exploring more complex patterns like idempotency, query state, and distributed transactions. My focus is on providing a range of options, each with its own advantages and drawbacks, to offer a comprehensive architect's perspective.<br><br><br>**Evaluating Further Solutions**<br><br>I'm now exploring the proactive state query approach in more detail. I'm focusing on clarifying the specific benefits and trade-offs. I also need to provide concrete examples, likely using a sequence diagram, to illustrate the precise steps. My goal is to outline all possible cases and provide a robust method to handle them consistently. I am thinking through the retry mechanisms and failure scenarios.<br><br><br>**Revising Solution Approaches**<br><br>I'm now refining the solution descriptions.  I'm focusing on the practical implications of idempotency and the proactive state query, clarifying the implementation details. I'm ensuring the user understands both the advantages and the potential complexities of each strategy. I'm working to provide a sequence diagram for the proactive approach to better explain this, and I'm currently assessing the implementation complexity and the trade-offs of these options.<br><br><br>**Developing Solution Framework**<br><br>I'm now formulating a comprehensive solution framework. This encompasses strategies ranging from idempotency to asynchronous eventing for this Spring Boot and MySQL scenario. I'm focusing on creating a decision tree to help the user choose the best approach based on their specific requirements.<br><br><br>**Evolving Solution Strategies**<br><br>I am now focusing on designing a framework, starting with idempotency, which might not be enough. Then, I am developing the solution for querying the transaction state. I am creating a decision-making guide to assist the user in choosing the most effective technique based on their unique requirements.<br><br><br>
  </details>
</div>

æ‚¨å¥½ï¼Œæ‚¨æå‡ºçš„è¿™ä¸ªé—®é¢˜æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€ä¸ªéå¸¸ç»å…¸ä¸”æ ¸å¿ƒçš„éš¾é¢˜ï¼Œé€šå¸¸è¢«ç§°ä¸ºâ€œè¯·æ±‚åœ¨ç–‘â€ï¼ˆIn-Doubt Requestï¼‰æˆ–â€œä¸ç¡®å®šçŠ¶æ€â€é—®é¢˜ã€‚ä½œä¸ºæ¶æ„å¸ˆï¼Œæˆ‘å¯ä»¥å‘Šè¯‰æ‚¨ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨è®¾è®¡ä»»ä½•æœ‰çŠ¶æ€æœåŠ¡æ—¶éƒ½å¿…é¡»ä¼˜å…ˆè€ƒè™‘çš„åœºæ™¯ã€‚

é¦–å…ˆï¼Œæˆ‘æ¥ç›´æ¥å›ç­”æ‚¨çš„æœ€åä¸€ä¸ªé—®é¢˜ï¼š

> æœåŠ¡ä¼šä¸»åŠ¨å›æ»šä¹‹å‰çš„äº‹åŠ¡ä¹ˆï¼Ÿ

**ä¸ä¼šã€‚**

åŸå› åœ¨äºï¼Œå½“æœåŠ¡ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸æ•°æ®åº“ä¹‹é—´çš„è¿æ¥å› ç½‘ç»œæŠ–åŠ¨æˆ–æ•°æ®åº“é‡å¯è€Œä¸­æ–­æ—¶ï¼ŒæœåŠ¡ç«¯çš„ `TransactionManager` (åœ¨Springä¸­) ä¼šæ•è·åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼ˆå¦‚ `CommunicationsException`, `TimeoutException` ç­‰ï¼‰ã€‚æ­¤æ—¶ï¼Œå¯¹äºæœåŠ¡æ¥è¯´ï¼Œå®ƒä¸æ•°æ®åº“çš„ä¼šè¯ï¼ˆSessionï¼‰å·²ç»ä¸¢å¤±ï¼Œäº‹åŠ¡ä¸Šä¸‹æ–‡ä¹Ÿéšä¹‹é”€æ¯ã€‚å®ƒå¤±å»äº†ä¸æ•°æ®åº“â€œæ²Ÿé€šâ€çš„èƒ½åŠ›ï¼Œå› æ­¤**æ— æ³•**å†å‘æ•°æ®åº“å‘é€ `ROLLBACK` æˆ– `COMMIT` æŒ‡ä»¤ã€‚å®ƒå”¯ä¸€èƒ½åšçš„å°±æ˜¯å‘ä¸Šå±‚ä¸šåŠ¡ä»£ç æŠ›å‡ºå¼‚å¸¸ã€‚

### é—®é¢˜çš„æ ¸å¿ƒï¼šçŠ¶æ€ä¸ä¸€è‡´

æ­¤æ—¶ï¼Œç³»ç»Ÿå¤„äºä¸€ä¸ªå±é™©çš„ä¸ä¸€è‡´çŠ¶æ€ï¼š

* **æœåŠ¡è§†è§’**ï¼šæ“ä½œå¤±è´¥äº†ã€‚å®ƒä¼šè®°å½•é”™è¯¯æ—¥å¿—ï¼Œå¯èƒ½ä¼šå‘ä¸Šæ¸¸è¿”å›å¤±è´¥å“åº”ã€‚
* **æ•°æ®åº“è§†è§’**ï¼šæ“ä½œå¯èƒ½æ˜¯æˆåŠŸçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤±è´¥çš„ã€‚
 * **å¯èƒ½æˆåŠŸ**ï¼šæ•°æ®åº“æ”¶åˆ°äº† `UPDATE` è¯·æ±‚ï¼ŒæˆåŠŸæ‰§è¡Œå¹¶**å·²æäº¤ (Committed)**ï¼Œåªæ˜¯åœ¨è¿”å›æˆåŠŸå“åº”çš„é€”ä¸­ç½‘ç»œæ–­å¼€äº†ã€‚
 * **å¯èƒ½å¤±è´¥**ï¼šè¯·æ±‚åœ¨ç½‘ç»œä¸­ä¸¢å¤±ï¼Œä»æœªåˆ°è¾¾æ•°æ®åº“ï¼›æˆ–è€…æ•°æ®åº“æ¥æ”¶ååœ¨æ‰§è¡Œæˆ–æäº¤å‰å®•æœºï¼Œäº‹åŠ¡è¢«è‡ªåŠ¨å›æ»šã€‚

é‚£ä¹ˆï¼ŒæœåŠ¡è¯¥å¦‚ä½•åˆ¤å®šæœ€ç»ˆçŠ¶æ€å¹¶ç¡®ä¿æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿè¿™æ­£æ˜¯æ¶æ„è®¾è®¡çš„å…³é”®æ‰€åœ¨ã€‚ç®€å•çš„â€œå¤±è´¥åé‡è¯•â€æ˜¯ç»å¯¹ä¸å¯å–çš„ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´ä¸šåŠ¡æ“ä½œè¢«é‡å¤æ‰§è¡Œï¼ˆä¾‹å¦‚ï¼Œé‡å¤æ‰£æ¬¾ï¼‰ã€‚

ä»¥ä¸‹æ˜¯å‡ ç§ä¸šç•Œæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼ŒæŒ‰æ¨èç¨‹åº¦å’Œå¤æ‚åº¦é€’å¢æ’åˆ—ï¼š

---

### æ–¹æ¡ˆä¸€ï¼šæ ¸å¿ƒæ€æƒ³â€”â€”å¹‚ç­‰æ€§è®¾è®¡ (Idempotency)

è¿™æ˜¯æœ€é‡è¦ã€ä¹Ÿæ˜¯æœ€ä¼˜å…ˆæ¨èçš„è§£å†³æ–¹æ¡ˆã€‚å¹‚ç­‰æ€§æ˜¯æŒ‡å¯¹åŒä¸€ä¸ªæ“ä½œæ‰§è¡Œä¸€æ¬¡å’Œæ‰§è¡Œå¤šæ¬¡ï¼Œæ‰€äº§ç”Ÿçš„å½±å“æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚å¦‚æœæ‚¨çš„`UPDATE`æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼Œé‚£ä¹ˆå³ä½¿ç®€å•é‡è¯•ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚

**å¦‚ä½•å®ç°å¹‚ç­‰æ€§ï¼š**

1. **å”¯ä¸€ä¸šåŠ¡ID / è¯·æ±‚ID**ï¼š
 * **æœºåˆ¶**ï¼šåœ¨æœåŠ¡å‘èµ·è¯·æ±‚æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è¯·æ±‚IDï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨UUIDæˆ–é›ªèŠ±ç®—æ³•ï¼‰ã€‚å°†è¿™ä¸ªIDä¸ä¸šåŠ¡æ“ä½œä¸€åŒæäº¤ç»™æ•°æ®åº“ã€‚
 * **æ•°æ®åº“è®¾è®¡**ï¼šåœ¨ç›¸å…³è¡¨ä¸­å¢åŠ ä¸€ä¸ª `request_id` å­—æ®µï¼Œå¹¶ä¸ºå…¶å»ºç«‹å”¯ä¸€ç´¢å¼• (`UNIQUE KEY`)ã€‚
 * **ä¸šåŠ¡é€»è¾‘**ï¼š
 * ä¸å†æ˜¯ç®€å•çš„ `UPDATE`ï¼Œè€Œæ˜¯å…ˆé€šè¿‡ `request_id` æŸ¥è¯¢æ“ä½œæ˜¯å¦å·²è¢«æ‰§è¡Œã€‚
 * æˆ–è€…ï¼Œåˆ©ç”¨æ•°æ®åº“çš„ç‰¹æ€§ï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªâ€œæ“ä½œè®°å½•è¡¨â€ï¼Œæ¯æ¬¡æ“ä½œå‰å…ˆ `INSERT` è¿™æ¡å¸¦å”¯ä¸€ `request_id` çš„è®°å½•ã€‚å¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼›å¦‚æœå› å”¯ä¸€é”®å†²çªè€Œå¤±è´¥ï¼Œè¯´æ˜æ“ä½œå·²æ‰§è¡Œï¼Œç›´æ¥è¿”å›æˆåŠŸã€‚

 **ä¼ªä»£ç ç¤ºä¾‹ï¼š**
```java
    // Controller Layer
    public Response performUpdate(String orderId, String requestId) {
        try {
            updateService.process(orderId, requestId);
            return Response.success();
        } catch (Exception e) {
            // å½“å‡ºç°ç½‘ç»œæŠ–åŠ¨ç­‰å¼‚å¸¸æ—¶
            boolean isSuccess = checkStatusService.isOperationSucceeded(requestId);
            if (isSuccess) {
                return Response.success(); // è™½ç„¶æœ¬æ¬¡è°ƒç”¨å¤±è´¥ï¼Œä½†æŸ¥è¯¢åå‘ç°æ“ä½œå·²æˆåŠŸ
            } else {
                return Response.failure("Operation failed");
            }
        }
    }

    // Service Layer
    @Transactional
    public void process(String orderId, String requestId) {
        // 1. æ’å…¥æ“ä½œè®°å½•ï¼Œåˆ©ç”¨å”¯ä¸€é”®é˜²æ­¢é‡å¤
        operationLogRepository.insert(new OperationLog(requestId, orderId, "PROCESSING"));

        // 2. æ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡æ›´æ–°
        orderRepository.updateStatus(orderId, "PAID");
    }
```

2.  **çŠ¶æ€æœºä¸ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰**ï¼š
    *   **æœºåˆ¶**ï¼šåœ¨è¦æ›´æ–°çš„è¡¨ä¸Šå¢åŠ ä¸€ä¸ª `version` å­—æ®µã€‚
    *   **ä¸šåŠ¡é€»è¾‘**ï¼š`UPDATE` æ“ä½œå˜ä¸º `UPDATE my_table SET status = 'new_status', version = version + 1 WHERE id = ? AND version = ?`ã€‚
    *   **å¤„ç†æµç¨‹**ï¼šå½“ç¬¬ä¸€æ¬¡è¯·æ±‚æˆåŠŸä½†å“åº”ä¸¢å¤±æ—¶ï¼Œ`version` å·²ç»æ”¹å˜ã€‚æœåŠ¡ä¾§å› è¶…æ—¶è€Œé‡è¯•æ—¶ï¼Œä¼šå¸¦ç€æ—§çš„ `version` å€¼å»æ‰§è¡Œ `UPDATE`ï¼Œæ­¤æ—¶ `WHERE` æ¡ä»¶ä¸æ»¡è¶³ï¼Œ`UPDATE` çš„å½±å“è¡Œæ•°ä¸º0ã€‚æœåŠ¡ä¾¿å¯çŸ¥é“ä¹‹å‰çš„æ“ä½œå¾ˆå¯èƒ½å·²ç»æˆåŠŸäº†ã€‚

---

### æ–¹æ¡ˆäºŒï¼šä¸»åŠ¨æŸ¥è¯¢å›æº¯ (Proactive Querying)

è¿™æ˜¯ä¸€ç§åœ¨å¼‚å¸¸å¤„ç†å—ä¸­è§£å†³â€œä¸ç¡®å®šçŠ¶æ€â€çš„ç›´æ¥æ–¹æ³•ã€‚

**å¤„ç†æµç¨‹ï¼š**

```mermaid
sequenceDiagram
 participant Service as æœåŠ¡
 participant DB as æ•°æ®åº“

 Service->>DB: å‘èµ· UPDATE è¯·æ±‚ (äº‹åŠ¡å¼€å§‹)
 Note right of DB: DB æ‰§è¡Œå¹¶ Commit æˆåŠŸ
 DB-->>Service: è¿”å›æˆåŠŸå“åº”
 Note over Service,DB: X æ­¤æ—¶ç½‘ç»œä¸­æ–­ï¼Œå“åº”ä¸¢å¤± X

 Service->>Service: æ•è· TimeoutException / ConnectionException
 Note over Service: è¿›å…¥å¼‚å¸¸å¤„ç†é€»è¾‘

 Service->>DB: (å¼€å¯æ–°è¿æ¥) å‘èµ· SELECT æŸ¥è¯¢
 Note over Service: æŸ¥è¯¢ç›®æ ‡è®°å½•çš„çŠ¶æ€<br/>æ˜¯å¦å·²ç»è¢«ä¿®æ”¹ä¸ºé¢„æœŸçš„çŠ¶æ€ï¼Ÿ

 alt çŠ¶æ€å·²å˜æ›´
 DB-->>Service: è¿”å›æ›´æ–°åçš„è®°å½•
 Service->>Service: åˆ¤å®šåŸå§‹æ“ä½œæˆåŠŸï¼Œæ‰§è¡Œåç»­é€»è¾‘
 else çŠ¶æ€æœªå˜æ›´
 DB-->>Service: è¿”å›åŸå§‹è®°å½•
 Service->>Service: åˆ¤å®šåŸå§‹æ“ä½œå¤±è´¥ï¼Œå¯å†³å®šé‡è¯•æˆ–æ”¾å¼ƒ
 end
```

**ä¼˜ç‚¹**ï¼šé€»è¾‘æ¸…æ™°ï¼Œå®ç°ç›¸å¯¹ç®€å•ã€‚
**ç¼ºç‚¹**ï¼š
* åœ¨å¼‚å¸¸å¤„ç†ä¸­å¢åŠ äº†é¢å¤–çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œå¢åŠ äº†æ•…éšœæ¢å¤çš„å»¶è¿Ÿã€‚
* éœ€è¦ä¸šåŠ¡é€»è¾‘èƒ½æ˜ç¡®åœ°é€šè¿‡æŸ¥è¯¢æ¥åˆ¤æ–­æ“ä½œæ˜¯å¦æˆåŠŸã€‚

---

### æ–¹æ¡ˆä¸‰ï¼šåˆ†å¸ƒå¼äº‹åŠ¡åè°ƒå™¨æˆ–æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ

å½“ä¸šåŠ¡æµç¨‹éå¸¸å¤æ‚ï¼Œè·¨è¶Šå¤šä¸ªæœåŠ¡æˆ–æ•°æ®åº“æ—¶ï¼Œä¸Šè¿°æ–¹æ¡ˆå¯èƒ½ä¸è¶³ä»¥åº”å¯¹ã€‚æ­¤æ—¶éœ€è¦å¼•å…¥æ›´å®è§‚çš„æ¶æ„æ¨¡å¼ã€‚

1. **äº‹åŠ¡æ¶ˆæ¯ï¼ˆä»¥RocketMQä¸ºä¾‹ï¼‰**ï¼š
 * **æœºåˆ¶**ï¼šåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„äº‹åŠ¡æ¶ˆæ¯åŠŸèƒ½ã€‚
 * **æµç¨‹**ï¼š
 1. æœåŠ¡å…ˆå‘ MQ å‘é€ä¸€ä¸ªâ€œåŠæ¶ˆæ¯â€ï¼ˆPrepare Messageï¼‰ã€‚
 2. å¦‚æœåŠæ¶ˆæ¯å‘é€æˆåŠŸï¼ŒæœåŠ¡å†æ‰§è¡Œæœ¬åœ°æ•°æ®åº“äº‹åŠ¡ã€‚
 3. æ ¹æ®æœ¬åœ°äº‹åŠ¡çš„ç»“æœï¼ŒæœåŠ¡å†å‘ MQ å‘é€ `COMMIT` æˆ– `ROLLBACK`ã€‚
 4. å¦‚æœç¬¬3æ­¥å› æœåŠ¡å®•æœºç­‰åŸå› å¤±è´¥ï¼ŒMQ ä¼šå®šæœŸå›è°ƒæœåŠ¡ï¼ŒæŸ¥è¯¢æœ¬åœ°äº‹åŠ¡çš„æœ€ç»ˆçŠ¶æ€ï¼Œä»¥å†³å®šæ˜¯æäº¤è¿˜æ˜¯å›æ»šè¯¥æ¶ˆæ¯ã€‚
 * **é€‚ç”¨åœºæ™¯**ï¼šé€‚ç”¨äºéœ€è¦ç¡®ä¿æœ¬åœ°æ“ä½œä¸æ¶ˆæ¯å‘é€åŸå­æ€§çš„åœºæ™¯ã€‚

2. **Transactional Outbox æ¨¡å¼**ï¼š
 * **æœºåˆ¶**ï¼šè¿™æ˜¯å®ç°å¯é äº‹ä»¶å‘å¸ƒçš„é»„é‡‘æ ‡å‡†ï¼Œä¹Ÿæ˜¯æœ€ç»ˆä¸€è‡´æ€§çš„æ ¸å¿ƒæ¨¡å¼ä¹‹ä¸€ã€‚
 * **æµç¨‹**ï¼š
 1. åœ¨**åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡**ä¸­ï¼Œæ—¢æ›´æ–°ä¸šåŠ¡è¡¨ï¼Œåˆå‘ä¸€ä¸ª `outbox`ï¼ˆå‘ä»¶ç®±ï¼‰è¡¨ä¸­æ’å…¥ä¸€æ¡äº‹ä»¶è®°å½•ã€‚
 2. ç”±äºè¿™æ˜¯å•ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œå› æ­¤ä¸šåŠ¡æ•°æ®æ›´æ–°å’Œäº‹ä»¶æ’å…¥å…·æœ‰åŸå­æ€§ã€‚
 3. ä¸€ä¸ªç‹¬ç«‹çš„ã€å¯é çš„**ä¸­ç»§è¿›ç¨‹**ï¼ˆRelay Processï¼‰ä¼šæŒç»­æ‰«æ `outbox` è¡¨ï¼Œå°†äº‹ä»¶å‘å¸ƒåˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaï¼‰ã€‚
 4. å‘å¸ƒæˆåŠŸåï¼Œæ›´æ–°æˆ–åˆ é™¤ `outbox` è¡¨ä¸­çš„è®°å½•ã€‚
 * **ä¼˜ç‚¹**ï¼šå®Œå…¨è§£è€¦äº†ä¸šåŠ¡é€»è¾‘å’Œæ¶ˆæ¯å‘å¸ƒï¼Œéå¸¸å¯é ï¼Œæ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„é¦–é€‰ã€‚

### æ€»ç»“ä¸æ¶æ„å¸ˆå»ºè®®

| æ–¹æ¡ˆ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | å…³é”®ä¼˜åŠ¿ |
| :--- | :--- | :--- | :--- |
| **å¹‚ç­‰æ€§è®¾è®¡** | ä½ | **ç»å¤§å¤šæ•°å•ä½“æˆ–ç®€å•å¾®æœåŠ¡åœºæ™¯** | ä»æ ¹æœ¬ä¸Šè§£å†³é‡å¤æ“ä½œé—®é¢˜ï¼Œå¥å£®ä¸”ä¼˜é›… |
| **ä¸»åŠ¨æŸ¥è¯¢å›æº¯** | ä¸­ | éœ€è¦å¿«é€Ÿã€åŒæ­¥åœ°ç¡®è®¤çŠ¶æ€çš„ç®€å•åœºæ™¯ | é€»è¾‘ç›´æ¥ï¼Œæ˜“äºç†è§£å’Œå®ç° |
| **åˆ†å¸ƒå¼äº‹åŠ¡/æœ€ç»ˆä¸€è‡´æ€§** | é«˜ | è·¨å¤šä¸ªæœåŠ¡çš„å¤æ‚ä¸šåŠ¡æµç¨‹ | æä¾›è·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯ï¼Œå¯é æ€§æé«˜ |

ä½œä¸ºæ¶æ„å¸ˆï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼š

1. **å°†å¹‚ç­‰æ€§ä½œä¸ºæœåŠ¡æ¥å£è®¾è®¡çš„ç¬¬ä¸€åŸåˆ™**ã€‚æ— è®ºæ˜¯å¦é¢„è§åˆ°ç½‘ç»œé—®é¢˜ï¼Œæ‰€æœ‰æ‰§è¡ŒçŠ¶æ€å˜æ›´çš„å†™æ“ä½œï¼ˆ`POST`, `PUT`, `DELETE`ï¼‰éƒ½åº”è®¾è®¡ä¸ºå¹‚ç­‰çš„ã€‚è¿™æ˜¯æ„å»ºå¥å£®ç³»ç»Ÿçš„åŸºçŸ³ã€‚
2. å¯¹äºç®€å•çš„ã€å¯åŒæ­¥ç¡®è®¤çš„åœºæ™¯ï¼Œ**ä¸»åŠ¨æŸ¥è¯¢å›æº¯**æ˜¯ä¸€ä¸ªå¯ä»¥æ¥å—çš„è¾…åŠ©æ‰‹æ®µã€‚
3. å½“ä½ çš„ç³»ç»Ÿæ¼”è¿›åˆ°å¾®æœåŠ¡æ¶æ„ï¼Œæ¶‰åŠè·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§æ—¶ï¼Œè¯·åŠ¡å¿…é‡‡ç”¨**Transactional Outbox**æˆ–**äº‹åŠ¡æ¶ˆæ¯**è¿™ç±»æœ€ç»ˆä¸€è‡´æ€§æ¨¡å¼ï¼Œé¿å…ä½¿ç”¨é‡é‡çº§çš„ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ç­‰å¼ºä¸€è‡´æ€§åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå› ä¸ºå®ƒä»¬å¯¹ç³»ç»Ÿæ€§èƒ½å’Œå¯ç”¨æ€§çš„å½±å“å¤ªå¤§ã€‚

é€šè¿‡ä¸Šè¿°è®¾è®¡ï¼Œå³ä½¿é¢å¯¹ç½‘ç»œæŠ–åŠ¨ã€æ•°æ®åº“é‡å¯ç­‰ä¸ç¨³å®šå› ç´ ï¼Œæ‚¨çš„ç³»ç»Ÿä¹Ÿèƒ½ä¿æŒæ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚
